<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>G√©n√©rateur Code Carnot - Centre L√©on B√©rard</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    *{margin:0;padding:0;box-sizing:border-box;}

    :root{
      --clb-rose:#c4165a;
      --clb-rose-light:#d63d73;
      --clb-blue:#003d82;
      --clb-blue-light:#0066cc;
      --clb-blue-pale:#e8f0ff;
      --clb-border:#e0e0e0;
      --clb-dark:#2c2c2c;
      --success:#27ae60;
      --error:#c0392b;
    }

    body{
      font-family:'Inter',sans-serif;
      background:#fff;
      color:var(--clb-dark);
    }

    /* NAVBAR */
    .navbar{
      position:fixed;top:0;left:0;right:0;
      background:#fff;
      border-bottom:1px solid var(--clb-border);
      z-index:1000;
    }
    .navbar-container{
      max-width:1100px;
      margin:auto;
      padding:12px 20px;
      display:flex;
      align-items:center;
      gap:14px;
    }
    .navbar-logo img{height:48px;}
    .navbar-title{
      font-size:18px;
      font-weight:800;
      color:var(--clb-blue);
    }

    /* PAGE */
    .container{
      max-width:800px;
      margin:110px auto 50px;
      padding:0 20px;
    }
    .card{
      background:#fff;
      border:1px solid var(--clb-border);
      border-radius:12px;
      padding:36px;
    }

    h1{
      text-align:center;
      font-size:30px;
      font-weight:800;
      background:linear-gradient(135deg,var(--clb-blue),var(--clb-rose));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      margin-bottom:8px;
    }
    .subtitle{
      text-align:center;
      font-size:14px;
      color:#666;
      margin-bottom:22px;
    }

    /* ESPACES (IMPORTANT) */
    .section-header{
      margin:32px 0 16px;
      font-weight:800;
      color:var(--clb-blue);
      border-bottom:2px solid var(--clb-rose);
      padding-bottom:8px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .form-group{margin-bottom:26px;}
    label{
      display:block;
      font-weight:700;
      font-size:14px;
      margin-bottom:8px;
    }
    input,select{
      width:100%;
      padding:12px 14px;
      border:1.5px solid var(--clb-border);
      border-radius:8px;
      font-size:14px;
    }
    select{
      appearance:none;
      background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12'%3E%3Cpath fill='%23c4165a' d='M6 9L1 4h10z'/%3E%3C/svg%3E")
      no-repeat right 14px center;
    }

    .grid-2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:22px;
    }

    .checkbox-group{
      margin-top:10px;
      display:flex;
      align-items:center;
      gap:10px;
      padding:12px;
      background:var(--clb-blue-pale);
      border-radius:8px;
    }

    button{
      width:100%;
      padding:14px;
      background:linear-gradient(135deg,var(--clb-rose),var(--clb-rose-light));
      color:#fff;
      border:none;
      border-radius:8px;
      font-weight:800;
      cursor:pointer;
    }

    .alert{
      display:none;
      padding:14px;
      margin-top:14px;
      border-left:4px solid;
      font-size:14px;
    }
    .alert-success{background:#f0fdf4;color:var(--success);border-color:var(--success);}
    .alert-error{background:#fef0f2;color:var(--error);border-color:var(--error);}

    .code-box{
      display:none;
      margin-top:28px;
      padding:24px;
      border:2px solid var(--clb-rose);
      border-radius:12px;
      text-align:center;
    }
    .code{
      font-size:38px;
      font-weight:900;
      color:var(--clb-rose);
      margin-bottom:14px;
    }

    .mini-actions{
      display:flex;
      gap:12px;
      justify-content:center;
      flex-wrap:wrap;
    }
    .mini-btn{
      width:auto;
      padding:10px 16px;
      font-size:13px;
      font-weight:800;
      border-radius:8px;
      border:none;
      cursor:pointer;
    }
    .mini-btn.secondary{
      background:linear-gradient(135deg,var(--clb-blue),var(--clb-blue-light));
      color:#fff;
    }

    .footer{
      margin-top:60px;
      padding:24px;
      text-align:center;
      font-size:12px;
      color:#999;
      border-top:2px solid var(--clb-rose);
      background:#f5f5f5;
    }

    @media(max-width:768px){
      .grid-2{grid-template-columns:1fr;}
    }
  </style>
</head>

<body>

<nav class="navbar">
  <div class="navbar-container">
    <div class="navbar-logo">
      <img src="./Logo-centre-leon-berard-lyon.png" alt="CLB">
    </div>
    <div class="navbar-title">G√©n√©rateur Code Carnot</div>
  </div>
</nav>

<div class="container">
  <div class="card">

    <h1>Formulaire Carnot</h1>
    <p class="subtitle">Le code Carnot est g√©n√©r√© automatiquement</p>

    <!-- BOUTON EN HAUT -->
    <button type="submit" form="carnotForm">‚úì G√©n√©rer Code Carnot</button>

    <div id="formError" class="alert alert-error"></div>
    <div id="formSuccess" class="alert alert-success"></div>

    <form id="carnotForm">

      <div class="section-header">üìù Informations Projet</div>

      <div class="grid-2">
        <div class="form-group">
          <label>R√©f√©rence interne</label>
          <input type="text" id="formRef">
        </div>
        <div class="form-group">
          <label>Intitul√© du projet</label>
          <input type="text" id="formIntitule">
        </div>
      </div>

      <div class="section-header">üè∑Ô∏è Classification</div>

      <label>A ‚Äî √âquipe juridique</label>
      <select id="formA" required>
        <option value="" selected disabled>S√©lectionner‚Ä¶</option>
        <option value="1">Juridique H√¥pital CLB</option>
        <option value="2">Juridique DRCI CLB</option>
        <option value="3">Valo / Juridique recherche</option>
        <option value="4">LIP / EZUS / UCBL</option>
        <option value="5">CNRS</option>
        <option value="6">INSERM</option>
      </select>

      <label>B ‚Äî Type de contrat</label>
      <select id="formB" required>
        <option value="" selected disabled>S√©lectionner‚Ä¶</option>
        <option value="1">MTA / DTA</option>
        <option value="2">Collaboration</option>
        <option value="3">Prestation</option>
        <option value="4">Contrat de financement</option>
        <option value="5">Clinique Phase I</option>
        <option value="6">Clinique Phase II</option>
        <option value="7">Clinique Phase III</option>
      </select>

      <label>C ‚Äî Pilotage</label>
      <select id="formC" required>
        <option value="" selected disabled>S√©lectionner‚Ä¶</option>
        <option value="1">DRCI promotion CLB</option>
        <option value="2">Investigation Indus</option>
        <option value="3">√âquipe recherche</option>
        <option value="4">Plateformes</option>
      </select>

      <label>D ‚Äî Financeur</label>
      <select id="formD" required>
        <option value="" selected disabled>S√©lectionner‚Ä¶</option>
        <option value="1">Public</option>
        <option value="2">Association</option>
        <option value="3">Industrie</option>
      </select>

      <label>E ‚Äî Propri√©t√©</label>
      <select id="formE" required>
        <option value="" selected disabled>S√©lectionner‚Ä¶</option>
        <option value="1">CLB propri√©taire</option>
        <option value="2">Publication uniquement</option>
        <option value="3">Aucune valorisation</option>
      </select>

      <div class="section-header">üí∞ Montant</div>

      <input type="number" id="formMontant" value="0" required>

      <div class="checkbox-group">
        <input type="checkbox" id="formPME">
        <label for="formPME">PME</label>
      </div>

    </form>

    <div id="codeBox" class="code-box">
      <div class="code" id="generatedCode"></div>

      <div class="mini-actions">
        <button class="mini-btn secondary" id="copyBtn">üìã Copier</button>
        <button class="mini-btn secondary" id="pdfBtn">üìÑ Export PDF</button>
        <button class="mini-btn" id="resetBtn">‚ûï R√©initialiser</button>
      </div>
    </div>

  </div>
</div>

<div class="footer">
  <p><strong>Centre L√©on B√©rard ‚Äî G√©n√©rateur Code Carnot</strong></p>
  <p>Contact : beyram.frigui@lyon.unicancer.fr</p>
</div>

<script>
  function calculateF(m,p){
    if(m<0)return 6;
    if(m===0)return 5;
    if(m<15000)return 1;
    if(m<=30000)return p?2:3;
    return 4;
  }

  function showError(msg){
    formError.textContent=msg;
    formError.style.display="block";
    formSuccess.style.display="none";
  }

  function showSuccess(msg){
    formSuccess.innerHTML=msg;
    formSuccess.style.display="block";
    formError.style.display="none";
  }

  carnotForm.addEventListener("submit",e=>{
    e.preventDefault();

    if(!formA.value||!formB.value||!formC.value||!formD.value||!formE.value){
      showError("Merci de s√©lectionner A, B, C, D et E.");
      return;
    }

    const f=calculateF(+formMontant.value||0,formPME.checked);
    const code=`CT ${formA.value}${formB.value}${formC.value}${formD.value}${formE.value}${f}`;

    generatedCode.textContent=code;
    codeBox.style.display="block";
    showSuccess(`‚úÖ Code g√©n√©r√© : <strong>${code}</strong>`);
  });

  copyBtn.onclick=async()=>{
    await navigator.clipboard.writeText(generatedCode.textContent);
    showSuccess("‚úÖ Code copi√©");
  };

  resetBtn.onclick=()=>{
    carnotForm.reset();
    codeBox.style.display="none";
    formError.style.display="none";
    formSuccess.style.display="none";
  };

  pdfBtn.onclick=()=>window.print();
</script>

</body>
</html>
