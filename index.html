<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>G√©n√©rateur Code Carnot - Centre L√©on B√©rard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    :root{
      --clb-rose:#c4165a;--clb-rose-light:#d63d73;--clb-blue:#003d82;
      --clb-blue-light:#0066cc;--clb-blue-pale:#e8f0ff;
      --clb-border:#e0e0e0;--clb-dark:#2c2c2c;
      --clb-success:#27ae60;--clb-error:#c0392b;
    }
    body{
      font-family:'Inter',sans-serif;background:#fff;color:var(--clb-dark);
    }
    .navbar{
      position:fixed;top:0;left:0;right:0;background:#fff;
      border-bottom:1px solid var(--clb-border);z-index:1000;
    }
    .navbar-container{
      max-width:1100px;margin:auto;padding:12px 20px;
      display:flex;align-items:center;gap:14px;
    }
    .navbar-logo img{height:48px;width:auto;}
    .navbar-title{font-size:18px;font-weight:800;color:var(--clb-blue);}
    .container{max-width:800px;margin:100px auto 40px;padding:0 20px;}
    .card{
      background:#fff;border:1px solid var(--clb-border);
      border-radius:12px;padding:28px;
    }
    h1{
      font-size:30px;font-weight:800;
      background:linear-gradient(135deg,var(--clb-blue),var(--clb-rose));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      margin-bottom:6px;text-align:center;
    }
    .subtitle{text-align:center;color:#666;font-size:14px;margin-bottom:16px;}
    .section-header{
      margin:20px 0 12px;font-weight:800;color:var(--clb-blue);
      border-bottom:2px solid var(--clb-rose);padding-bottom:8px;
      display:flex;gap:8px;align-items:center;
    }
    .form-group{margin-bottom:18px;}
    label{font-weight:700;font-size:14px;margin-bottom:6px;display:block;}
    input,select,textarea{
      width:100%;padding:12px 14px;border:1.5px solid var(--clb-border);
      border-radius:8px;font-family:inherit;font-size:14px;
    }
    select{
      appearance:none;
      background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12'%3E%3Cpath fill='%23c4165a' d='M6 9L1 4h10z'/%3E%3C/svg%3E")
      no-repeat right 14px center;
    }
    textarea{min-height:100px;resize:vertical;}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
    .checkbox-group{
      display:flex;align-items:center;gap:10px;
      background:var(--clb-blue-pale);padding:12px;border-radius:8px;
    }
    button{
      width:100%;padding:14px;margin:14px 0;
      background:linear-gradient(135deg,var(--clb-rose),var(--clb-rose-light));
      color:#fff;border:none;border-radius:8px;font-weight:800;
      cursor:pointer;
    }
    .alert{display:none;padding:14px;border-left:4px solid;margin-bottom:12px;}
    .alert-success{background:#f0fdf4;color:var(--clb-success);border-color:var(--clb-success);}
    .alert-error{background:#fef0f2;color:var(--clb-error);border-color:var(--clb-error);}
    .code-box{
      display:none;margin-top:20px;padding:20px;border:2px solid var(--clb-rose);
      border-radius:12px;text-align:center;
    }
    .code{font-size:36px;font-weight:900;color:var(--clb-rose);}
    .footer{
      margin-top:60px;padding:24px;text-align:center;
      font-size:12px;color:#999;border-top:2px solid var(--clb-rose);
      background:#f5f5f5;
    }
    @media(max-width:768px){
      .grid-2{grid-template-columns:1fr;}
    }
  </style>
</head>

<body>

<nav class="navbar">
  <div class="navbar-container">
    <div class="navbar-logo">
      <img src="./Logo-centre-leon-berard-lyon.png" alt="CLB">
    </div>
    <div class="navbar-title">G√©n√©rateur Code Carnot</div>
  </div>
</nav>

<div class="container">
  <div class="card">

    <h1>Formulaire Carnot</h1>
    <p class="subtitle">Le code Carnot est g√©n√©r√© automatiquement √† partir des √©l√©ments saisis</p>

    <!-- ‚úÖ BOUTON EN HAUT (SANS CHANGER LE RESTE) -->
    <button type="submit" form="carnotForm">‚úì G√©n√©rer Code Carnot</button>

    <div id="formError" class="alert alert-error"></div>
    <div id="formSuccess" class="alert alert-success"></div>

    <form id="carnotForm">

      <div class="section-header">üìù Informations Projet</div>

      <div class="grid-2">
        <div class="form-group">
          <label>R√©f√©rence Interne</label>
          <input type="text" id="formRef">
        </div>
        <div class="form-group">
          <label>Intitul√© Projet</label>
          <input type="text" id="formIntitule">
        </div>
      </div>

      <div class="section-header">üè∑Ô∏è Classification</div>

      <label>√âquipe Juridique (A)</label>
      <select id="formA" required>
        <option value="" selected disabled>S√©lectionner‚Ä¶</option>
        <option value="1">Juridique H√¥pital CLB</option>
        <option value="2">Juridique DRCI CLB</option>
        <option value="3">Valo / Juridique recherche</option>
        <option value="4">LIP / EZUS / UCBL</option>
        <option value="5">CNRS</option>
        <option value="6">INSERM</option>
      </select>

      <label>Type de Contrat (B)</label>
      <select id="formB" required>
        <option value="" selected disabled>S√©lectionner‚Ä¶</option>
        <option value="1">MTA / DTA</option>
        <option value="2">Collaboration</option>
        <option value="3">Prestation</option>
        <option value="4">Contrat de financement / reversement</option>
        <option value="5">Clinique Phase I (ou I + II)</option>
        <option value="6">Clinique Phase II</option>
        <option value="7">Clinique Phase III</option>
        <option value="8">Collab Etude Ancillaire</option>
        <option value="9">H√©bergement</option>
      </select>

      <label>Pilotage Projet (C)</label>
      <select id="formC" required>
        <option value="" selected disabled>S√©lectionner‚Ä¶</option>
        <option value="1">DRCI promotion CLB Pr√©coces</option>
        <option value="2">DRCI Investigation Indus</option>
        <option value="3">DRCI Investigation CLB</option>
        <option value="4">Cellule projets / grant</option>
        <option value="5">EMS</option>
        <option value="6">√âquipe de recherche</option>
        <option value="7">DSI</option>
        <option value="8">Plateformes technologiques</option>
        <option value="9">√âquipe H√¥pital</option>
        <option value="0">Pilotage cotutelle</option>
      </select>

      <label>Financeur (D)</label>
      <select id="formD" required>
        <option value="" selected disabled>S√©lectionner‚Ä¶</option>
        <option value="1">Acad√©mique / Public</option>
        <option value="2">Association / Fondation</option>
        <option value="3">Fondation industrielle</option>
        <option value="4">Industrie Pharma / Biotech</option>
        <option value="5">Industrie Dispositif M√©dical</option>
        <option value="6">Industrie Data / IT</option>
        <option value="7">√âquipement recherche</option>
        <option value="8">CRO</option>
        <option value="9">Priv√© autre</option>
      </select>

      <label>Propri√©t√© (E)</label>
      <select id="formE" required>
        <option value="" selected disabled>S√©lectionner‚Ä¶</option>
        <option value="1">CLB propri√©taire donn√©es et r√©sultats</option>
        <option value="2">CLB propri√©taire donn√©es</option>
        <option value="3">CLB propri√©taire r√©sultats</option>
        <option value="4">Publication uniquement</option>
        <option value="5">Am√©lioration savoir-faire CLB</option>
        <option value="6">Aucune valorisation CLB</option>
      </select>

      <div class="section-header">üí∞ Montant</div>

      <input type="number" id="formMontant" value="0" required>

      <div class="checkbox-group">
        <input type="checkbox" id="formPME">
        <label for="formPME">PME</label>
      </div>

      <!-- (si tu avais d√©j√† un bouton en bas, tu peux le laisser, sinon celui du haut suffit) -->
      <!-- <button type="submit">‚úì G√©n√©rer Code Carnot</button> -->
    </form>

    <div id="codeBox" class="code-box">
      <h3>Code Carnot</h3>
      <div class="code" id="generatedCode"></div>
    </div>

  </div>
</div>

<div class="footer">
  <p><strong>Centre L√©on B√©rard ‚Äî G√©n√©rateur Code Carnot</strong></p>
  <p>Contact : <a href="mailto:beyram.frigui@lyon.unicancer.fr">beyram.frigui@lyon.unicancer.fr</a></p>
</div>

<script>
  function calculateF(m, p) {
    if (m < 0) return 6;
    if (m === 0) return 5;
    if (m < 15000) return 1;
    if (m <= 30000) return p ? 2 : 3;
    return 4;
  }

  function showError(message) {
    const el = document.getElementById('formError');
    el.textContent = message;
    el.style.display = 'block';
    document.getElementById('formSuccess').style.display = 'none';
  }

  function showSuccess(message) {
    const el = document.getElementById('formSuccess');
    el.innerHTML = message;
    el.style.display = 'block';
    document.getElementById('formError').style.display = 'none';
  }

  document.getElementById('carnotForm').addEventListener('submit', (e) => {
    e.preventDefault();

    // ‚úÖ r√©cup√©ration fiable
    const a = document.getElementById('formA').value;
    const b = document.getElementById('formB').value;
    const c = document.getElementById('formC').value;
    const d = document.getElementById('formD').value;
    const ee = document.getElementById('formE').value;

    // si rien choisi (le placeholder "S√©lectionner‚Ä¶")
    if (!a || !b || !c || !d || !ee) {
      showError("‚ùå Merci de s√©lectionner A, B, C, D et E.");
      return;
    }

    const montant = parseFloat(document.getElementById('formMontant').value || '0');
    const pme = document.getElementById('formPME').checked;

    const code = `CT ${a}${b}${c}${d}${ee}${calculateF(montant, pme)}`;

    document.getElementById('generatedCode').textContent = code;
    document.getElementById('codeBox').style.display = 'block';
    showSuccess(`‚úÖ <strong>Code g√©n√©r√© :</strong> <strong>${code}</strong>`);
  });
</script>

</body>
</html>
